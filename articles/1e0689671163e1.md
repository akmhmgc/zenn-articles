---
title: "Hash#sliceとActiveRecord::Core#sliceの違い"
emoji: "📚"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ['Ruby','rails']
published: false
---

## 概要
RailsではActiveRecord::BaseあるいはApplicationRecordを継承したクラスのインスタンスメソッドとして`slice`というメソッドを使用することができます。

```ruby
 Fruit.first.slice(:name)
  Fruit Load (0.1ms)  SELECT "fruits".* FROM "fruits" ORDER BY "fruits"."id" ASC LIMIT ?  [["LIMIT", 1]]
hello                                                                                        
=> {"name"=>"organge"}  
```

一方でこれとは別にRubyの`Hash#slice`が存在するので今回はソースコードを辿ることでメソッド内で行われている処理を確認します。


## ActiveRecord::Core#slice

https://github.com/rails/rails/blob/b1c5ae394782e3a766c99012d9ad87476d095544/activemodel/lib/active_model/access.rb#L8-L10

まず、複数の値を`methods`という引数に配列として受け取っています。[`Array#flatten`](https://docs.ruby-lang.org/ja/latest/method/Array/i/flatten.html)で配列を平坦化しているので、以下の二つの呼び出し方が可能になります。

```ruby
Fruit.first.slice(:name, :color)

# 引数methodsには[[:name, :color]]として渡るが平坦化されるので問題なし
Fruit.first.slice([:name, :color])
```
