---
title: "Hash#sliceã¨ActiveRecord::Core#sliceã®é•ã„"
emoji: "ğŸ“š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['Ruby','rails']
published: false
---

## æ¦‚è¦
Railsã§ã¯ActiveRecord::Baseã‚ã‚‹ã„ã¯ApplicationRecordã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦`slice`ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ruby
 Fruit.first.slice(:name)
  Fruit Load (0.1ms)  SELECT "fruits".* FROM "fruits" ORDER BY "fruits"."id" ASC LIMIT ?  [["LIMIT", 1]]
hello                                                                                        
=> {"name"=>"organge"}  
```

ä¸€æ–¹ã§ã“ã‚Œã¨ã¯åˆ¥ã«Rubyã®`Hash#slice`ãŒå­˜åœ¨ã™ã‚‹ã®ã§ä»Šå›ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¾¿ã‚‹ã“ã¨ã§ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§è¡Œã‚ã‚Œã¦ã„ã‚‹å‡¦ç†ã‚’ç¢ºèªã—ã¾ã™ã€‚


## ActiveRecord::Core#slice

https://github.com/rails/rails/blob/b1c5ae394782e3a766c99012d9ad87476d095544/activemodel/lib/active_model/access.rb#L8-L10

å‰åŠã¨ã—ã¦`methods.flatten`ã®ç®‡æ‰€ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚
ã¾ãšã€è¤‡æ•°ã®å€¤ã‚’`methods`ã¨ã„ã†å¼•æ•°ã«é…åˆ—ã¨ã—ã¦å—ã‘å–ã£ã¦ã„ã¾ã™ã€‚ã¾ãŸã€[`Array#flatten`](https://docs.ruby-lang.org/ja/latest/method/Array/i/flatten.html)ã§é…åˆ—ã‚’å¹³å¦åŒ–ã—ã¦ã„ã¾ã™ã€‚

```ruby
[1, [2, 3, [4], 5]].flatten
=> [1, 2, 3, 4, 5]
```

ã‚ˆã£ã¦ä»¥ä¸‹ã®äºŒã¤ã®å‘¼ã³å‡ºã—æ–¹ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

```ruby
Fruit.first.slice(:name, :color)

# å¼•æ•°methodsã«ã¯[[:name, :color]]ã¨ã—ã¦æ¸¡ã‚‹ãŒå¹³å¦åŒ–ã•ã‚Œã‚‹ã®ã§ä¸Šã¨åŒã˜
Fruit.first.slice([:name, :color])
```

ç¶šã„ã¦å¾ŒåŠã§ã€`index_with { |method| public_send(method) }`ã®ç®‡æ‰€ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

`Enumerable#index_with`ã¯Railsã®æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚å„è¦ç´ ã‚’ã‚­ãƒ¼ã¨ã—ã¦ã€æŒ‡å®šã—ãŸå¼•æ•°ã‚„ãƒ–ãƒ­ãƒƒã‚¯ã‚’è©•ä¾¡ã—ãŸçµæœã‚’å€¤ã¨ã™ã‚‹Hashã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```ruby
# å¼•æ•°ã«æŒ‡å®šã—ãŸå€¤ã‚’å€¤ã¨ã™ã‚‹Hashã‚’ä½œã‚‹
[1,2].index_with(10)
=> {1=>10, 2=>10}

# è©•ä¾¡ã•ã‚ŒãŸãƒ–ãƒ­ãƒƒã‚¯ã®çµæœã‚’å€¤ã¨ã™ã‚‹Hashã‚’ä½œã‚‹
['a', 'b'].index_with{ |str| str.upcase }
=> {"a"=>"A", "b"=>"B"}

# name, colorã¨ã„ã†ã‚«ãƒ©ãƒ ï¼ˆ=publicãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã‚’æŒã¤Fruitãƒ¢ãƒ‡ãƒ«
['name', 'color'].index_with{ |attr_name| Fruit.first.public_send(attr_name) }
=> {"name"=>"apple", "color"=>"red"}
```

æœ€å¾Œã®`with_indifferent_access`ã¯Hashã‚’æ‹¡å¼µã—ãŸ`HashWithIndifferentAccess`ã«å¤‰æ›ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚å®šç¾©æ™‚ã®ã‚­ãƒ¼ãŒã‚·ãƒ³ãƒœãƒ«ã§ã‚ã£ã¦ã‚‚æ–‡å­—åˆ—ã§å‘¼ã³å‡ºã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚‹ãªã©ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

```ruby
hash = { name: 'tarou' }
hash.class #=> Hash
# æ™®é€šã¯nilãŒã‹ãˆã‚‹
hash['name'] #=> nil

hash = hash.with_indifferent_access
hash.class #=> => ActiveSupport::HashWithIndifferentAccess
# ã‚·ãƒ³ãƒœãƒ«ãƒ»æ–‡å­—åˆ—ã©ã£ã¡ã§ã‚‚å‘¼ã³å‡ºã›ã‚‹
hash['name'] #=> "tarou"
hash[:name] #=> "tarou"
```
